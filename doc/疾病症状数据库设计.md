## 疾病症状数据库录入设计

### 数据库表设计
- 原始疾病表 t_disease 录入的json直接存入该表，疾病跟症状原始数据源

|列名|列类型|注释|
|----|------|----|
|id|int(11)|自增id(主键)|
|icd|varchar(64)|疾病icd|
|name|varchar(128)|疾病名称|
|json_content|text|json内容
|sort|int(8)|疾病排序|
|create_time|TIMESTAMP|创建时间(默认当前时间用于后续可能的动态增量更新加载)|

|索引名|索引类型|索引字段|索引注释|
|------|--------|--------|--------|
|无|无|无|无|

- 解析疾病表 t_parse_disease 解析过的疾病表，由原始疾病表解析而来，构建疾病的树关系，原始疾病表中的一条记录对应该表中的1-n条记录

|列名|列类型|注释|
|----|------|----|
|id|int(11)|自增id(主键)|
|icd|varchar(64)|疾病icd|
|name|varchar(128)|疾病名称|
|disease_id|varchar(64)|疾病id，用于建立父子关联关系，唯一索引|
|parent_id|varchar(64)|父疾病id，用于建立父子关联关系|
|has_child|tinyint(3)|是否含有子节点，用于加快树加载速度，少一次子节点查询，属于冗余字段|
|sort|int(8)|疾病排序|
|create_time|TIMESTAMP|创建时间(默认当前时间用于后续可能的动态增量更新加载)

|索引名|索引类型|索引字段|索引注释
|------|--------|--------|--------|
|uni_disease_id|唯一索引|disease_id|疾病唯一标志，唯一索引保证唯一性同时提高疾病树加载速度|
|idx_disease_parent_child|普通索引|parent_id,has_child|用于加快索引树查询加载速度|

- 症状表 t_parse_symptom

|列名|列类型|注释|
|----|------|----|
|id|int(11)|自增id(主键)|
|content|varchar(64)|症状内容
|sort|int(8)|症状排序|
|source|tinyint(3)|症状来源(0:未知;1:检查;2:症状;3:流行病学)
|create_time|TIMESTAMP|创建时间(默认当前时间用于后续可能的动态增量更新加载)

|索引名|索引类型|索引字段|索引注释|
|------|--------|--------|--------|
|uni_symptom_content|唯一索引|content|用来保持症状的唯一性|

- 属性表 t_parse_properties


|列名|列类型|注释|
|----|------|----|
|id|int(11)|自增id(主键)|
|content|varchar(64)|属性内容
|type|tinyint(3)|属性类型(0:未知类型;1:性质[ddp];2:频率[ddf];3:时间[ddt];4:条件[ddc];5:程度[dde];)
|sort|int(8)|属性排序|
|create_time|TIMESTAMP|创建时间(默认当前时间用于后续可能的动态增量更新加载)

|索引名|索引类型|索引字段|索引注释|
|------|--------|--------|--------|
|uni_properties_content|唯一索引|content|用来保持症状的唯一性|


- 症状属性表 t_parse_symptom_properties 建立疾病 症状 属性的关联关系

|列名|列类型|注释|
|----|------|----|
|id|int(11)|自增id(主键)|
|disease_id|int(11)|疾病id|
|symptom_id|int(11)|症状id|
|propreties_id|varchar(2048)|关联属性id,使用;分割|
|parent_id|int(11)|父关联id|
|has_child|tinyint(3)|是否含有子节点，用于加快树加载速度，少一次子节点查询，属于冗余字段|
|relation|varchar(16)|子节点关系|
|weight|double|权重
|neg_weight|double|负向权重
|chance|double|概率
|neg_chance|double|负向概率
|sort|int(8)|属性排序|
|create_time|TIMESTAMP|创建时间(默认当前时间用于后续可能的动态增量更新加载)

|索引名|索引类型|索引字段|索引注释|
|------|--------|--------|--------|
|idx_disease_symptom_parent|普通索引|desease_id,symptom_id,parent_id,sort|用于加快症状树查询加载速度

### 关联关系设计
![关联关系](./症状录入关联关系设计.png)

### 数据库脚本

    -- t_disease
    DROP TABLE
    IF EXISTS t_disease;

    CREATE TABLE t_disease (
        id INT (11) COMMENT '自增id(主键)',
        icd VARCHAR (64) COMMENT '疾病icd',
        NAME VARCHAR (128) COMMENT '疾病名称',
        json_content text COMMENT 'json内容',
        sort INT (8) COMMENT '疾病排序',
        create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间(默认当前时间用于后续可能的动态增量更新加载)',
        PRIMARY KEY (id)
    ) COMMENT = '原始疾病表,用于保存原始json';

    -- t_parse_disease
    DROP TABLE
    IF EXISTS t_parse_disease;

    CREATE TABLE t_parse_disease (
    	id INT (11) COMMENT '自增id(主键)',
    	icd VARCHAR (64) COMMENT '疾病icd',
    	NAME VARCHAR (128) COMMENT '疾病名称',
    	disease_id VARCHAR (64) COMMENT '疾病id，用于建立父子关联关系，唯一索引',
    	parent_id VARCHAR (64) COMMENT '父疾病id，用于建立父子关联关系',
    	has_child TINYINT (3) COMMENT '是否含有子节点，用于加快树加载速度，少一次子节点查询，属于冗余字段',
    	sort INT (8) COMMENT '疾病排序',
    	create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间(默认当前时间用于后续可能的动态增量更新加载)',
    	PRIMARY KEY (id)
    ) COMMENT = '解析疾病表,构建疾病树关系';

    CREATE UNIQUE INDEX uni_disease_id ON t_parse_disease (disease_id) COMMENT '疾病唯一标志，唯一索引保证唯一性同时提高疾病树加载速度';

    CREATE INDEX idx_disease_parent_child ON t_parse_disease (parent_id, has_child) COMMENT '用于加快索引树查询加载速度';

    -- t_parse_symptom
    DROP TABLE
    IF EXISTS t_parse_symptom;

    CREATE TABLE t_parse_symptom (
    	id INT (11) COMMENT '自增id(主键)',
    	content VARCHAR (64) COMMENT '症状内容',
    	sort INT (8) COMMENT '症状排序',
    	source TINYINT (3) COMMENT '症状来源(0:未知;1:检查;2:症状;3:流行病学)',
    	create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间(默认当前时间用于后续可能的动态增量更新加载)',
    	PRIMARY KEY (id)
    ) COMMENT = '症状表,元症状表';

    CREATE UNIQUE INDEX uni_symptom_content ON t_parse_symptom (content) COMMENT '用来保持症状的唯一性';
    
    -- t_parse_properties
    DROP TABLE
    IF EXISTS t_parse_properties;
    
    CREATE TABLE t_parse_properties (
    	id INT (11) COMMENT '自增id(主键)',
    	content VARCHAR (64) COMMENT '属性内容',
    	type TINYINT (3) COMMENT '属性类型(0:未知类型;1:性质[ddp];2:频率[ddf];3:时间[ddt];4:条件[ddc];5:程度[dde];)',
    	sort INT (8) COMMENT '属性排序',
    	create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间(默认当前时间用于后续可能的动态增量更新加载)',
    	PRIMARY KEY (id)
    ) COMMENT = '属性表,元属性表';
    
    CREATE UNIQUE INDEX uni_properties_content ON t_parse_properties (content) COMMENT '用来保持属性的唯一性';
    
    -- t_parse_symptom_properties;
    DROP TABLE
    IF EXISTS t_parse_symptom_properties;
    
    CREATE TABLE t_parse_symptom_properties (
    	id INT (11) COMMENT '自增id(主键)',
    	disease_id INT (11) COMMENT '疾病id',
    	symptom_id INT (11) COMMENT '症状id',
    	propreties_id VARCHAR (2048) COMMENT '关联属性id,使用;分割',
    	parent_id INT (11) COMMENT '父关联id',
    	has_child TINYINT (3) COMMENT '是否含有子节点，用于加快树加载速度，少一次子节点查询，属于冗余字段',
    	relation VARCHAR (16) COMMENT '子节点关系',
    	weight DOUBLE COMMENT '权重',
    	neg_weight DOUBLE COMMENT '负向权重',
    	chance DOUBLE COMMENT '概率',
    	neg_chance DOUBLE COMMENT '负向概率',
    	sort INT (8) COMMENT '属性排序',
    	create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间(默认当前时间用于后续可能的动态增量更新加载)',
    	PRIMARY KEY (id)
    ) COMMENT = '症状属性表 建立疾病 症状 属性的关联关系';
    
    CREATE INDEX idx_disease_symptom_parent ON t_parse_symptom_properties (
    	disease_id,
    	symptom_id,
    	parent_id,
    	sort
    ) COMMENT '关联索引用于加快症状树查询加载速度';
    
    














